## Feature requirements

### Content Elements
- Column Titles
  - Task Titles
  - Task Descriptions

## The structure of the Content Elements is as this:

- Horizontal Rows allow Columns to be structured into vertically limited height groups. Each Row can have any number of Stacks
- Vertical Stacks allow combing Columns in a vertical Group. Any Column without a #stack tag is put on an new Stack, any Column with a #stack tag stays on the same Stack as the previous Column.

Any of the "Content Elements" can be edited by the User.

### Content Editing Methods

There are multiple Types of content editing
- Inline Editor
  - in markdown mode (plain text markdown)
  - wysiwyg editor mode (visual editor, but entry is only using keyboard)
- Overlay Editor
  - in markdown mode
  - dual pane markdown mode, with realtime preview and some editing modes
  - wysiwyg editor with buttons for formatting and inserts.

### Content Editor

- can use VS Code shortcuts to insert snippets (meta/ctrl/alt/shift combinations)
- supports undo/redo in editors
- snippet insertion by name or inline snippet content
- All embed/link types (Link, Image, Include and Wiki) have a burger menu with consistent actions. Alt+Click opens in VS Code first, and falls back to the system editor.
  - Open (in VS Code if available, otherwise in the system defined tool)
  - Reveal in File Explorer
  - Search for Replacement File
  - Browse for Replacement File
  - Convert to Relative or Absolute Path
  - Delete
- All dynamic diagrams have a burger menu with multiple actions.
  - Convert to SVG
  - Copy SVG to Clipboard
  - Copy Markdown Code

### Top bar

#### Left

- Filename
- Yaml header settings
  - Marp Options
  - Pandoc Options

#### Middle 

- Card drop source
- Column drop source

#### Right

- Column folding
- Column header stickyness
- Card sorting
- Active processes
- Save state
- Layout Templates
- Main burger Menu

### Settings & Preferences

- WYSIWYG enable/disable
- Overlay editor enable/disable
- Overlay editor default mode
- Overlay editor font scale
- Path generation mode (relative/absolute)
- Template bar visibility
- Backup settings
- Sidebar auto-scan
- Layout presets

### General Drag & Drop

Dragging and Dropping allows the creation of Tasks from Drop Sources or reordering Tasks and Columns within the Kanban Board. 

#### Importing

External Drop sources can be files from the VsCode Explorer. 
Files from outside the Editor (which opens a import dialogue ).
Indirectly clipboard data (via the drop sources).

### File Import Dialogue

To keep files from duplicating the kanban board keeps a hashes of files in the workspaces. If a file is found in the hashes which is dropped into the kanban it can be linked into the kanban. If the file is not found it can be created from the data in the Media folder. This is needed because a vscode plugin cannot access the filepath of a dropped file, only it's content.

Dialogue Options:
- Link existing file (if it's found in the hash database, othervise disabled)
- Copy file to Media folder (if the file is not found in the hash database, othervise it's disabled)
- Search for file (by filename)
- Open Media folder (in System File Explorer to manually move it) 
- Cancel
Copying a file to the Media folder updates the hash database.

### Hash Database (MediaIndex)

It keeps a hash of media files that can be used in the kanban, preventing duplicates. The hash is generated by the first megabyte of the file data, the last modification time and the filesize.

The hash database can scan (keep an index of):
- the media folder(s) of the main file and the included markdown files
- whole folder and all subfolders of the main file and the included markdown files
- all workspaces.
This scan scope is configurable.

### Drop Sources for Columns

Column Drop sources can be dropped anywhere in the board
- Empty column
- Column from clipboard data
- Column from templates

### Drop Sources for Tasks

Task Drop sources can be dropped in all Tasks
- Empty task
- Task from clipboard data (can handle binary images, which creates them in a {filename}-Media folder)
- Empty excalidraw & drawio diagrams

### Copying Data

- Columns and Tasks can be copied as MARP Markdown format

### Pasting Data

- Pasting using shift+ctrl+v or shift+meta+v pastes a image link using all forms of copied data.
  - It pastes it if no file exists in the media folder of the file it's pased into.

### Column Templates

Column templates allow creating templates of multiple columns that can be dropped somewhere in the kanban board.

### Processes

- Media index scan
- Media index cancel


### WYSIWYG Editor
- if a text is selected and the link-button or the image-button is clicked, the text is classified (filename/path vs normal text) and placed in the right part of the link, keeping the selection.
- if a text is selected and any of the styling buttons are pressed, the style is applied and the selection stays.
- link/image/include/wiki elements are editable via the burger menu.
- if "show marp features" is active. then have all the marp classes available to activate in the editor which we also have on the burger menu of the task.
- the standard styling options and all important markdown features must be available to select from the button-menu:
  - B, I, U, S, Mark, Sub, Sup (text style)
  - Link, Image, Include, Wiki (embed/link)
  - Code, Block, Footnote, Columns (block-style), Tables
- it must be possible to put new content inside, before and after all blocks (and on the same line). putting content into an object differs for each type.
  - image/document/video link has at least 3 elements [alt-text](link "description")
  - includes and wiki-link use the same burger menu as the image/document/video links. but they dont have a alt text or a description.
  - code might also be mermaid or plantuml diagrams and must render as such.
  - columns can be modified in the number of columns (-/+ in the top corners). The ---: :--: :--- must be on separate newlines.

### Markdown / Marp file including

Using the !!!include(filename.md)!!! a Marp presentation can be imported and directly edited from within the Kanban Board.
The include statement can be added to the Column Header (best for large presentations), the Task Header (smaller data) or directly into a Task Content (content is read-only).

### Markdown Features

- Underline, sub, sup, mark
- Footnotes
- Multi-column blocks
- Image figures
- HTML comment handling
- Markdown-it extensions for kanban rendering

### Tags

- Tags are written as #tag in titles or descriptions.
- Tags can be colorized and categorized.
- Tag visibility can be toggled (show all, hide, or only show for layout tags).
- Tag configuration can be used in templates and formatting.

### Export

- Export board content using Marp or Pandoc integrations.
- Export options are controlled via YAML header settings.
- Export respects include files and embedded assets.

#### Marp 

- Uses the Marp engine to generate slide decks from tasks/columns.
- Theme and class settings can be configured from the YAML header.

#### Pandoc

- Uses Pandoc to export to additional formats.
- Pandoc binary path and options can be configured in settings.

### Sorting

- Manual sorting via drag & drop.
- Optional sorting tools from the top bar.

### Visual File Embeddings

Files can be embedded using ![alt-text](/path/to/file.jpg "text to image") . All browser supported images are working, also videos (only a few audio codecs) and DrawIo and Excalidraw.

A Burger Menu allows modification of path. Seaching for alternatives if a filepath is broken.

### PDF

- PDF page previews
- PDF slideshows

### DrawIo, Excalidraw

These types of diagrams can be directly added to the board, they will render to a cached image which is displayed in the Kanban. Alt+Clicking allows to edit them. A burger menu allows other modifications of the filename.

### Mermaid & PlantUML

- Mermaid diagrams
- PlantUML diagrams
- Diagram previews in WYSIWYG and overlay


### Search and Broken file finding

- Broken links/images show a visible state.
- Burger menu actions can search or browse for a replacement file.
- Search can be done by filename and updates the path inline.


### Burger menu is for the embeds, links, etc:
- types that show the menu
  - embeds ![]()
  - links []()
    - embeds and links also can have the {} after
  - includes !!!include()!!!
  - links <>
  - wiki-links [[]]
  - ```plantuml or mermaid
```
- all media and links allways have the burger menu, when it's a broken link we show it in errors style and show the burger menu allways visible, if it's valid it only shows on hover. All links are relative to the file the link is in. If it's an included file, its relative to it's path. the menu options typically are:
  - open (open the media in the builtin or external editor associated with the mediatype)
  - reveal in file explorer
  - search for file (search for alternative file with the same filename)
  - browse for file (file-dialogue to select the fiels)
  - convert to relative / absolute (filepath)
  - delete


### Replacement File Search

the replacement file / link search helps finding files if the link to it is broken.
- it searches in all workspaces for the filename (which can be edited)
- specific searches such as regex, match case and full word can be toggled
- it lists the results below, a toggle allows previewing the files
- preview are closed when the view is closed or the preview toggled off
- a "replace all" allows fixing all paths that share the complete same path. 
  - it displays the count of occurances of the path and how many files can be successfully found at the new location. 
  - only files that can be found in the new location will be fixed.
- the user can select wether it generates a relative or absolute path, or the default setting.
  - it displays a preview of the new filepath
- the paths are generated relative to the file.
  - in the main file it's relative to the main file
  - in an included file it's relative to the included filepath
- it only re-renders the parts (columns/tasks) of the kanban that has been modified.

### Plugin Architecture

All rendering, import and export features are managed through a central PluginRegistry. Plugins can be individually disabled via the `markdown-kanban.plugins.disabled` setting.

#### Import Plugins
Handle `!!!include()!!!` syntax in different contexts:
- **ColumnIncludePlugin** — includes in column headers (loads full markdown files as column content)
- **TaskIncludePlugin** — includes in task headers (loads markdown as task content)
- **RegularIncludePlugin** — includes in task descriptions (read-only embedded content)

#### Export Plugins
Route export operations through the plugin system:
- **MarpExportPlugin** — PDF, PPTX, HTML exports via Marp CLI. Supports watch mode, custom themes, custom engine, handout generation.
- **PandocExportPlugin** — DOCX, ODT, EPUB exports via Pandoc CLI. Supports platform-specific path resolution.

ExportService checks plugin availability before conversion. ExportCommands queries plugins for status, themes, and version info.

#### Diagram Plugins
Render code blocks and file-based diagrams to SVG/PNG for display and export:
- **PlantUMLPlugin** — renders `plantuml`/`puml` code blocks via Java + PlantUML JAR
- **MermaidPlugin** — renders `mermaid` code blocks via webview-based Mermaid.js (queue-based with 30s timeout)
- **DrawIOPlugin** — renders `.drawio`/`.dio` files via draw.io CLI
- **ExcalidrawPlugin** — renders `.excalidraw` files via excalidraw-worker.js + Playwright
- **PDFPlugin** — renders PDF pages to PNG via pdftoppm (poppler)
- **EPUBPlugin** — renders EPUB pages to PNG via mutool
- **XlsxPlugin** — renders spreadsheet sheets to PNG via LibreOffice

All diagram plugins share a common interface: `isAvailable()`, `canRenderCodeBlock()`, `canRenderFile()`, `renderCodeBlock()`, `renderFile()`. The DiagramPreprocessor uses these plugins to convert diagrams before Marp/Pandoc export.